<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>13.1 HTML5 APIs | MAD9014</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Cross-Platform Application Development">
    
    <link rel="preload" href="/F2022/assets/css/0.styles.50f415bc.css" as="style"><link rel="preload" href="/F2022/assets/js/app.42156b92.js" as="script"><link rel="preload" href="/F2022/assets/js/2.309c8f6c.js" as="script"><link rel="preload" href="/F2022/assets/js/29.ba3d8131.js" as="script"><link rel="preload" href="/F2022/assets/js/4.8f0492b2.js" as="script"><link rel="preload" href="/F2022/assets/js/6.42129677.js" as="script"><link rel="prefetch" href="/F2022/assets/js/10.6ed74506.js"><link rel="prefetch" href="/F2022/assets/js/11.e4e57652.js"><link rel="prefetch" href="/F2022/assets/js/12.4fd9334c.js"><link rel="prefetch" href="/F2022/assets/js/13.d60171d2.js"><link rel="prefetch" href="/F2022/assets/js/14.ef5f94d3.js"><link rel="prefetch" href="/F2022/assets/js/15.89cba5d1.js"><link rel="prefetch" href="/F2022/assets/js/16.07b0adef.js"><link rel="prefetch" href="/F2022/assets/js/17.274ce64a.js"><link rel="prefetch" href="/F2022/assets/js/18.83156930.js"><link rel="prefetch" href="/F2022/assets/js/19.dd8c0299.js"><link rel="prefetch" href="/F2022/assets/js/20.905940c5.js"><link rel="prefetch" href="/F2022/assets/js/21.0ecc185a.js"><link rel="prefetch" href="/F2022/assets/js/22.8c4f615d.js"><link rel="prefetch" href="/F2022/assets/js/23.cbd124fb.js"><link rel="prefetch" href="/F2022/assets/js/24.f984b5df.js"><link rel="prefetch" href="/F2022/assets/js/25.cae0bd53.js"><link rel="prefetch" href="/F2022/assets/js/26.171c675d.js"><link rel="prefetch" href="/F2022/assets/js/27.b6b19a01.js"><link rel="prefetch" href="/F2022/assets/js/28.762bb28a.js"><link rel="prefetch" href="/F2022/assets/js/3.0ff4921b.js"><link rel="prefetch" href="/F2022/assets/js/30.9f8ef05e.js"><link rel="prefetch" href="/F2022/assets/js/31.b43b0ef2.js"><link rel="prefetch" href="/F2022/assets/js/32.c63a796c.js"><link rel="prefetch" href="/F2022/assets/js/33.b7b22e5a.js"><link rel="prefetch" href="/F2022/assets/js/34.410d0f9e.js"><link rel="prefetch" href="/F2022/assets/js/35.b935e2dc.js"><link rel="prefetch" href="/F2022/assets/js/36.27336e61.js"><link rel="prefetch" href="/F2022/assets/js/37.62aa130b.js"><link rel="prefetch" href="/F2022/assets/js/38.3da4e238.js"><link rel="prefetch" href="/F2022/assets/js/39.ffcb03f3.js"><link rel="prefetch" href="/F2022/assets/js/40.b0afee99.js"><link rel="prefetch" href="/F2022/assets/js/41.eeb38dd7.js"><link rel="prefetch" href="/F2022/assets/js/42.2e322fc2.js"><link rel="prefetch" href="/F2022/assets/js/43.3d75d1e0.js"><link rel="prefetch" href="/F2022/assets/js/44.d343e4db.js"><link rel="prefetch" href="/F2022/assets/js/45.35ad5dce.js"><link rel="prefetch" href="/F2022/assets/js/46.17dcf00b.js"><link rel="prefetch" href="/F2022/assets/js/5.71716d92.js"><link rel="prefetch" href="/F2022/assets/js/7.ea52c00d.js"><link rel="prefetch" href="/F2022/assets/js/8.78988ea0.js"><link rel="prefetch" href="/F2022/assets/js/9.2c22e4b4.js">
    <link rel="stylesheet" href="/F2022/assets/css/0.styles.50f415bc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/F2022/" class="home-link router-link-active"><img src="/F2022/mad-d-logo-sm.png" alt="MAD9014" class="logo"> <span class="site-name can-hide">MAD9014</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/F2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2022/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/F2022/conventions/" class="nav-link">
  Conventions
</a></div><div class="nav-item"><a href="/F2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/F2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2022/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/F2022/conventions/" class="nav-link">
  Conventions
</a></div><div class="nav-item"><a href="/F2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/F2022/modules/week1/intro/" class="sidebar-link">1.1: Introduction</a></li><li><a href="/F2022/modules/week2/functions/" class="sidebar-link">2.1: Functions and Scope</a></li><li><a href="/F2022/modules/week2/flow-strings/" class="sidebar-link">2.2: Truthiness, Control Flow and Strings</a></li><li><a href="/F2022/modules/week3/math-numbers/" class="sidebar-link">3.1: Math and Numbers</a></li><li><a href="/F2022/modules/week3/dates-loops/" class="sidebar-link">3.2: Dates and Loops</a></li><li><a href="/F2022/modules/week4/arrays/" class="sidebar-link">4.1: Arrays</a></li><li><a href="/F2022/modules/week4/objects/" class="sidebar-link">4.2: Objects</a></li><li><a href="/F2022/modules/week5/dom-1/" class="sidebar-link">5.1: Document Object Model</a></li><li><a href="/F2022/modules/week5/dom-2/" class="sidebar-link">5.2: Document Object Model</a></li><li><a href="/F2022/modules/week6/events/" class="sidebar-link">6.1: Handling Events</a></li><li><a href="/F2022/modules/week7/project-structure/" class="sidebar-link">7.1: Project Structure</a></li><li><a href="/F2022/modules/week7/code-structure/" class="sidebar-link">7.2: Code Structure</a></li><li><a href="/F2022/modules/reading/" class="sidebar-link">8: Reading Week</a></li><li><a href="/F2022/modules/week9/promises/" class="sidebar-link">9.1: Promises</a></li><li><a href="/F2022/modules/week9/async/" class="sidebar-link">9.2: Asynchronous Programming</a></li><li><a href="/F2022/modules/week10/ajax/" class="sidebar-link">10.1: AJAX and Fetch</a></li><li><a href="/F2022/modules/week10/fetch-apis/" class="sidebar-link">10.2: Fetch and APIs</a></li><li><a href="/F2022/modules/week11/fetch-data/" class="sidebar-link">11.1: Dynamic Data</a></li><li><a href="/F2022/modules/week11/security/" class="sidebar-link">11.2: Fetch Security</a></li><li><a href="/F2022/modules/week12/observers/" class="sidebar-link">12.1: Observers &amp; Classes</a></li><li><a href="/F2022/modules/week12/destructure/" class="sidebar-link">12.2: Destructuring, Spead, &amp; Enumeration</a></li><li><a href="/F2022/modules/week13/storage/" aria-current="page" class="active sidebar-link">13.1: HTML5 APIs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/F2022/modules/week13/storage/#web-storage-api" class="sidebar-link">Web Storage API</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/week13/storage/#single-source-of-truth" class="sidebar-link">Single Source of Truth</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/week13/storage/#geolocation" class="sidebar-link">Geolocation</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/week13/storage/#history-api" class="sidebar-link">History API</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/week13/storage/#cache-api" class="sidebar-link">Cache API</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/week13/storage/#more-html5-apis" class="sidebar-link">More HTML5 APIs</a></li><li class="sidebar-sub-header"><a href="/F2022/modules/week13/storage/#what-to-do-this-week" class="sidebar-link">What to do this week</a></li></ul></li><li><a href="/F2022/modules/week13/multi-page/" class="sidebar-link">13.2: Multi-Page, SPA, and JAMStack </a></li><li><a href="/F2022/modules/week14/project-1/" class="sidebar-link">14.1: Forms &amp; Page Transitions</a></li><li><a href="/F2022/modules/week14/project-2/" class="sidebar-link">14.2: Final Project</a></li><li><a href="/F2022/modules/week15/" class="sidebar-link">15.1: Final Project</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title blue">
    Web Apps
  </div> <h1>13.1 HTML5 APIs</h1></header> <h2 id="web-storage-api"><a href="#web-storage-api" class="header-anchor">#</a> Web Storage API</h2> <p>The Web Storage API has two parts - <code>localStorage</code> and <code>sessionStorage</code>. They have the same methods and properties and
work the exact same way. The only difference is that the <code>sessionStorage</code> values are automatically deleted at the end of
the user's session. This means when they close the browser or the tab that contained the current domain as part of the
tab's current history.</p> <p>From this point on I will be referring to <code>localStorage</code> only but everything also applies to <code>sessionStorage</code>. Both are
a global property accessible from the <code>window</code> object in the browser. They do not exist in NodeJS.</p> <p>All the data stored in <code>localStorage</code> gets stored as a <code>JSON</code> string.</p> <p>This means that only information that is capable of being a JSON string can be saved in <code>localStorage</code>. No functions, no
DOM elements, can be stored in <code>localStorage</code>.</p> <p>We will need to use the built-in <code>JSON</code> methods to convert the data back and forth between a string and an object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'The Big Bang Theory'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">seasons</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
  <span class="token literal-property property">firstSeasonYear</span><span class="token operator">:</span> <span class="token number">2007</span><span class="token punctuation">,</span>
  <span class="token literal-property property">stillPlaying</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//convert the object into a JSON string.</span>
<span class="token keyword">let</span> stringData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//convert the string back into an object</span>
<span class="token keyword">let</span> objectCopy <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>stringData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>If you ever need to make a deep copy of an object, this is one way of doing it.</p> <p>If the data that you want to convert to JSON is already a just a string, then you should not use the <code>JSON.stringify()</code>
method as it will add an extra set of quotation marks.</p> <div class="custom-block tip"><p class="custom-block-title">Remember</p> <p>It is important to remember that we have no way of editing the strings inside of <code>localStorage</code>. All we can ever do is
replace the string with a new one.</p></div> <p>Every time we read or write a value from <code>localStorage</code> we need to use a unique key. The key will be the unique name for
that chunk of data. All keys need to be String values. An example key that you could use for an assignment would be
<code>abcd0001-com.example-userscores</code>. It has a username, a domain name, and a descriptive term for what the data is.</p> <div class="custom-block warning"><p class="custom-block-title">Unique Key Names</p> <p>Remember to keep your <code>localStorage</code> key names unique. You don't want to overwrite other data being saved in
localStorage or have your data overwritten. Use a name that includes a reference to the domain, the web application, and
even your own development team, plus the purpose of the data.</p></div> <h3 id="localstorage-methods"><a href="#localstorage-methods" class="header-anchor">#</a> LocalStorage Methods</h3> <p>The methods that we have for <code>localStorage</code> are: <code>getItem</code>, <code>setItem</code>, <code>removeItem</code>, <code>clear</code>, <code>key</code> and the property
<code>length</code>.</p> <p>The <code>length</code> property will tell you how many items have been saved in <code>localStorage</code> for the current domain. You can
create as many different keys as you want for your domain. Each key will have its own set of data.</p> <blockquote><p>JavaScript files use the Domain of the HTML page that loaded them as the domain context for things like cookies and
localStorage.</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//my global variable to hold the data, with default value.</span>
<span class="token keyword">let</span> storage <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'abcd0001-com.example-userscores'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//if there is no key matching this then we will get undefined as the value.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>storage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//we got some data. Use JSON.parse to turn the string into an object</span>
  myData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>storage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">//nothing matched. No data under that key yet.</span>
  <span class="token comment">//Setting a default value is a good idea.</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'abcd0001-com.example-userscores'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>myData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//don't forget the JSON.stringify() part.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>To remove a key and its value we would use the <code>removeItem</code> method. It needs the key.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'abcd0001-com.example-userscores'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>To remove ALL keys and values for the current domain, use the <code>clear</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If you think that there may be lots of possible keys for the current domain and you want to search through them, you can
use the <code>key</code> method in conjunction with the <code>length</code> property and a loop.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> len <span class="token operator">=</span> localStorage<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is the name of the </span><span class="token template-punctuation string">`</span></span>$<span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">th key.</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" target="_blank" rel="noopener noreferrer">MDN Reference for LocalStorage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage" target="_blank" rel="noopener noreferrer">MDN Reference for SessionStorage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API" target="_blank" rel="noopener noreferrer">MDN guide to WebStorage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="session-storage"><a href="#session-storage" class="header-anchor">#</a> Session Storage</h3> <p>Session Storage has the exact same methods and properties and abilities as <code>localStorage</code>. The difference is that when
the browser tab is closed or the browser is shut down then all the stored data is marked for deletion.</p> <p>When it comes to the methods in <code>sessionStorage</code>, they are the same as the <code>localStorage</code> ones. Just replace <code>local</code>
with <code>session</code> and they will all work.</p> <h3 id="storage-events"><a href="#storage-events" class="header-anchor">#</a> Storage Events</h3> <p>There is actually a storage event that you can listen for to trigger functionality on your page. If you have content on
your page that is built based on content coming from Local or Session Storage you will want to know if that content has
changed.</p> <p>For the current window you are looking at you will know if it changes because it can only change if you actually call
the <code>localStorage.setItem</code> method.</p> <p>However, it is possible that your user has multiple concurrent windows or tabs open for your website. If the user does
something in Tab <code>B</code> then you will want to know in Tab <code>A</code> that the contents of <code>localStorage</code> have been updated. This
is why we have the storage event.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'storage'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//decide what you want to do WHEN something in local or session storage has been updated.</span>
  ev<span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">//the key of the data that was updated</span>
  ev<span class="token punctuation">.</span>oldValue<span class="token punctuation">;</span> <span class="token comment">//the previous value for the key</span>
  ev<span class="token punctuation">.</span>newValue<span class="token punctuation">;</span> <span class="token comment">//the latest value for the key</span>
  ev<span class="token punctuation">.</span>url<span class="token punctuation">;</span> <span class="token comment">//the exact url of the tab/window that changed the storage</span>
  ev<span class="token punctuation">.</span>storageArea<span class="token punctuation">;</span> <span class="token comment">//a Storage object representing the container for the key that was updated.</span>
  <span class="token comment">// this last one is important because it points to Session or Local for the storage</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div title="Storage events across tabs" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/WxnjkZRt3_Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="single-source-of-truth"><a href="#single-source-of-truth" class="header-anchor">#</a> Single Source of Truth</h2> <p>When working with data sources like localStorage and cookies, which are not directly accessible as a variable, we need
to create what is known as a <code>single source of truth</code>.</p> <p>It is possible to have multiple functions in multiple scripts that are accessing the values in your cookies or
localStorage within the context of the same page load. If one script updates <code>localStorage</code> then we might not know that
the change was made in another function that is sharing that data.</p> <p>To avoid problems caused by this the best approach is to create your own <strong>globally accessible</strong> variable that will hold
the data.</p> <p>The <code>cookie</code> and <code>localStorage</code> values are the <strong>CACHED</strong> copy of the data. They only exist to give us context when the
app is loaded the next time. We do NOT work from them.</p> <p>When the page first loads, we read the value from the <code>cookie</code> and/or <code>localStorage</code> and put it into the global
variable.</p> <p>Any function that needs to access or change the information will make the change to that global variable.</p> <p>Each time the global variable is altered you can call on the <code>document.cookie</code> property or <code>localStorage.setItem</code> method
to update the <code>cached</code> value. Remember we are only updating the cache for the next time the app loads.</p> <p>The only time we ever read from the storage is when the app first loads - using the <code>DOMContentLoaded</code> event as our
trigger to fetch the cached data.</p> <h2 id="geolocation"><a href="#geolocation" class="header-anchor">#</a> Geolocation</h2> <p>The <code>Geolocation</code> object in the browser sits inside of the <code>window.navigator</code> object. It has three methods:</p> <ul><li><code>getCurrentPosition</code> A one time call to the current position.</li> <li><code>watchPosition</code> Similar to setInterval, it repeatedly asks for the position.</li> <li><code>clearWatch</code> stops the repeated calls to <code>watchPosition</code>.</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> failCallback<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">watchPosition</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> failCallback<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>The two functions are the same except that <code>getCurrentPosition</code> runs once and <code>watchPosition</code> runs repeatedly. If you
want to stop the <code>watchPosition</code> method running then we call:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">clearWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Both methods accept a success callback function and a failure callback function. The success function will be passed a
position object. The failure callback will be passed a position error object. See the code below for examples.</p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Position" target="_blank" rel="noopener noreferrer">MDN Position Object reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PositionError" target="_blank" rel="noopener noreferrer">MDN PositionError Object reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The third parameter is the options object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">enableHighAccuracy</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maximumAge</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><iframe src="//codepen.io/mad-d/embed/mymOBy/?height=526&amp;theme-id=0&amp;default-tab=js,result&amp;embed-version=2" width="100%" height="526" allowfullscreen="allowfullscreen" style="width:100%;">.</iframe> <p><a href="https://codepen.io/mad-d/pen/mymOBy" target="_blank" rel="noopener noreferrer">Codepen Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PositionOptions" target="_blank" rel="noopener noreferrer">MDN options object reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation" target="_blank" rel="noopener noreferrer">MDN Geolocation reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div title="geolocation" class="video-player"><iframe width="560" height="315" src="https://youtube.com/embed/NIAqR34eg7I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="history-api"><a href="#history-api" class="header-anchor">#</a> History API</h2> <p>Any time that you are using a browser, the whole reason that you are able to use the back and forward buttons is because
of the <code>History API</code>. Your browser maintains an Array of visited pages for each and every tab.</p> <p>Each entry in the history Array contains the full URL, including the querystring, plus the <code>state</code> data. The <code>state</code>
data includes setting values that you created through JavaScript to save in the history array entry plus form data that
was filled out if a form was submitted.</p> <p>The <code>History API</code> encompasses the history Array plus a collection of methods that let you move through that array,
events for monitoring navigation and movement through the array, and methods for updating what is written in the
location bar and entries in the history array.</p> <p>The <code>history</code> object is a top level object inside the <code>window</code> object, just like <code>document</code> and <code>navigator</code>. Here are
the basic property and methods for <code>history</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>history<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// the number of entries in the history array for the current tab</span>
history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// navigate back three steps in the history array</span>
history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// navigate back one step</span>
history<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//navigate forward one step</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The <code>history.state</code> property gives you the value of the current entry's state object.</p> <p>If you want to change the value of <code>state</code>, change or add an entry in the array, and change what is written in the
location bar, then we use these two methods:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//both these methods will change what is written in the location bar</span>
<span class="token comment">//replaceState will replace the current history array entry with a new value</span>
history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//pushState will add a new entry to the history array. The new value will become the current entry</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//title is ignored in all browsers except Firefox</span>
<span class="token comment">//state is the data object saved in association with the history array entry</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Notice</strong> that I did not say anything about navigating with these methods. They do not actually load anything. They add
or change an entry in the history array. They change what is written in the location bar. They DO NOT navigate or load
any page.</p> <p>The events that we can use, in conjunction with the <code>history api</code>, are <code>hashchange</code> and <code>popstate</code>.</p> <p>The <code>hashchange</code> event is fired when the fragment identifier of the URL has changed. The <code>Event</code> object associated with
<code>hashchange</code> has an <code>oldURL</code> and a <code>newURL</code> property that you can use as reference.</p> <p>The <code>popstate</code> event is fired when the active history entry changes while the user navigates the session history. This
means that the user has: clicked a link; or typed a new path in the location bar and hit enter; or clicked the forward
or back buttons. Calling <code>pushState()</code> or <code>replaceState()</code> will <strong>NOT</strong> trigger the <code>popstate</code> event.</p> <p>Typing a new hash value in the locationbar will not trigger a <code>popstate</code> event as the page has already loaded and a new
hash value just makes the browser try to scroll to a matching id. It will, however, trigger a <code>hashchange</code> event.</p> <p>A Single Page App (<code>SPA</code>) is the most common reason to use the <code>History API</code>. If you are building a <code>SPA</code> it means that
you are building a website with only one HTML file. You use JavaScript to manage the History array, what is written in
the location bar, the fetching and caching of new content, and the display of that content.</p> <p>The general approach is to add click listeners to your anchor tags and when the user clicks them, you use
<code>ev.preventDefault()</code> to stop the browser from trying to load the new url. Instead, you can take the url and, with
<code>pushState()</code> you can update the History and the location bar. Then call whatever functions you want to add and remove
the appropriate content.</p> <p>If you wanted, you could actually use <code>fetch()</code> to retrieve new HTML files and then display their content. Remember,
that the <code>Response</code> object has the <code>text()</code> method as well as the <code>json()</code> method. You can extract the text from an HTML
file and turn it into a HTML String that can be queried just like a normal HTML file.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./index.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navlink<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./stores.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navlink<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Stores<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./products.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navlink<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Products<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>By using <code>href</code> inside anchor tags it means that you could have static versions of those pages or routing set up on the
server that would be loaded if JavaScript was disabled.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">APP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> nav <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'nav'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nav<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token constant">APP</span><span class="token punctuation">.</span>handleNav<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">handleNav</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ev<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//stop browser navigating</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.navlink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//get the link that was clicked</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>a<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//exit function if no anchor was clicked</span>
    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//update history and location bar</span>
    <span class="token comment">//decide what to do next</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//home page...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'stores.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//stores page...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'products.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//products page...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token constant">APP</span><span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>You can also add listeners in the <code>init</code> function for <code>popstate</code> and <code>hashchange</code>. <code>popstate</code> function handles the user
clicking the back button or manually typing an address. The <code>hashchange</code> function handles clicking on other links that
only change the hash value in the url or the user manually typing a new hash value in the location bar.</p> <p>The <code>popstate</code> event and the <code>hashchange</code> event will both have their listeners attached to the <code>window</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> handlePopNav<span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> handleHashNav<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="popstate-vs-hashchange-vs-click-vs-load"><a href="#popstate-vs-hashchange-vs-click-vs-load" class="header-anchor">#</a> popstate vs hashchange vs click vs load</h3> <p>When you are trying to build a navigation system for your web app there are many different events that you can listen
for. Understanding the difference between what triggers these different events is key.</p> <p>Here is a list of what actions will trigger these events.</p> <p><strong>popstate</strong></p> <ul><li>moving between entries in the History array.</li> <li>loading a page by typing into the location bar</li> <li>clicking a link that loads a new URL</li></ul> <p><strong>hashchange</strong></p> <ul><li>moving between History array entries where only the hash value has changed.</li> <li>user has clicked on an anchor where href is just a hash value.</li> <li>user types in the location bar and only changes the hash value.</li></ul> <p><strong>click</strong></p> <ul><li>user clicks on an element on the page.</li> <li>this happens before any navigation would occur, so it is a chance to intercept and control the navigation.</li></ul> <p><strong>load</strong> or <strong>DOMContentLoaded</strong></p> <ul><li>moving to a new entry in the History array, as long as the pathname, not just the hash value has changed.</li> <li>initial load of a webpage.</li></ul> <div title="History API - part I" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/Mo9wn8jS1F8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <div title="History API - part II" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/ABllxOcsPsc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <div title="History pushState and replaceState" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/j1ZHuyhHApg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="cache-api"><a href="#cache-api" class="header-anchor">#</a> Cache API</h2> <p>Added as part of HTML5, the <code>Cache API</code> lets javascript developers intentionally save files, including data files, in
the browser to improve performance and reduce latency for repeated future visits.</p> <p>The <code>Cache API</code> is separate from the built-in browser cache that is controlled by the browser and HTTP Request and
Response Headers.</p> <p>When building a cache, the main reason you would want one is to be able to run your website when the network fails or
the user turns off their wifi. We want our app to be able to run offline after the initial load.</p> <p>While the <code>Cache API</code> is primarily used from Service Workers for Progressive Web Apps, we can also use it directly from
any webpage. (We will be talking about Service Workers soon).</p> <p>It is based on <a href="https://www.youtube.com/watch?v=SmPouEFKOBg&amp;list=PLyuRouwmQCjngZXVn48vYmPK_1yAF-fLw" target="_blank" rel="noopener noreferrer">Promises<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, just
like the <code>Fetch API</code>.</p> <h3 id="loading-the-cache"><a href="#loading-the-cache" class="header-anchor">#</a> Loading the Cache</h3> <p>When you want to save files in the cache to use later.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> cacheName <span class="token operator">=</span> <span class="token string">'myCache-v1'</span><span class="token punctuation">;</span> <span class="token comment">//key name for our cache</span>
<span class="token keyword">let</span> assets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/img/demo.jpg'</span><span class="token punctuation">,</span> <span class="token string">'/img/other.jpg'</span><span class="token punctuation">,</span> <span class="token string">'/img/joanne.png'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//the array of files to save in our cache</span>

caches
  <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> urlString <span class="token operator">=</span> <span class="token string">'/img/1011-800x600.jpg?id=one'</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>urlString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//add = fetch + put</span>

    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:5500/img/1011-800x600.jpg?id=two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'/img/1011-800x600.jpg?id=three'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//cache.addAll(assets).then() is an alternative that lets you save a list</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//the open method failed.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>In this example we are saving three copies of the same file (an image called <code>1011-800x600.jpg</code>) into our cache. This
could have been three different files. This code is just to illustrate that changing the querystring value makes the
browser view it as 3 different files.</p> <p>If you want to have an array of file names you could call the <code>cache.addAll</code> method and pass in the array. The current
domain name will be prepended to all those strings when the requests are made, unless another protocol and domain are
used at the start of the string.</p> <p>The <code>cache</code> object also has <code>fetch</code> and <code>put</code> methods. The <code>fetch</code> method will download the file. The <code>put</code> method will
save the file in the HTTP Response from the <code>fetch</code> in the cache. The <code>add</code> method does both the <code>fetch</code> and <code>put</code> steps
together.</p> <p>If you ever need to remove something from the cache then you can call the <code>cache.delete()</code> method to remove the file. It
takes a <code>Request</code>, <code>URL</code> or <code>USVString</code>, which represent the file, as an argument. It returns a Promise that resolves
when the file has been deleted.</p> <h3 id="reading-the-cache"><a href="#reading-the-cache" class="header-anchor">#</a> Reading the Cache</h3> <p>When you want to read a file from the cache then we use the <code>cache.match()</code> method. It will return a <code>Response</code> object,
just like a <code>fetch</code> call would. The difference is that it is looking at the internal browser cache for your domain under
the key used to create the <code>cache</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//the request argument can be a USVString, a URL object, or a Request object</span>
<span class="token comment">//the options argument is optional. It is an object with 3 properties</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//ignore the queryString</span>
  <span class="token literal-property property">ignoreMethod</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//ignore the method - POST, GET, etc</span>
  <span class="token literal-property property">ignoreVary</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//ignore if the response has a VARY header</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
cache
  <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something with the response object... just like you would with fetch</span>
    <span class="token comment">// if(! response.ok) throw new Error(response.statusText)</span>
    <span class="token comment">// response.json()</span>
    <span class="token comment">// response.blob()</span>
    <span class="token comment">// response.text()</span>
    <span class="token comment">// response.formData()</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="cache-control-header"><a href="#cache-control-header" class="header-anchor">#</a> Cache-Control Header</h3> <p>The <code>Cache API</code> is not to be confused with the <code>Cache-Control Header</code> that is part of the HTTP Response specification.
The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener noreferrer">Cache-Control Header<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a header that is
sent from the server or proxy-server to the client along with a requested file. It tells the browser how to handle the
caching of the requested file and how long it should be considered valid before requesting a new copy of the file.</p> <p>The name of the header is <code>cache-control</code> and it can hold a variety of directives. Here are a few examples of the header
showing some of the directives.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Cache-Control: max-age=604800
Cache-Control: no-cache
Cache-Control: max-age=604800, must-revalidate
Cache-Control: no-store
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>Next Semester, when you start building Progressive Web Apps (PWA) you will be using the Cache API to save copies of
files fetched from your web server or an API.</p></blockquote> <h2 id="more-html5-apis"><a href="#more-html5-apis" class="header-anchor">#</a> More HTML5 APIs</h2> <p>At this point you might be saying something like,</p> <blockquote><p>&quot;Holy Crap! That was a lot of code to get familiar with! I hope there aren't many more HTML5 APIs.&quot;</p></blockquote> <p>Well, there are actually ~120 HTML5 Web APIs.</p> <p>If you include the ones discussed on this page though, you have actually already learned <strong>over</strong> 20 of these. Another
~20 are just experimental ones and a few more have been deprecated. At least another 40 are ones that you are unlikely
to need unless you are working on a project that uses a very specific technology like the <code>Payment Request API</code> or
<code>Picture-in-Picture API</code> or <code>MediaStream Recording API</code> or <code>Web Audio API</code> or <code>WebXR Device API</code>.</p> <p>There is a new API coming called <code>Navigation API</code> which is designed to replace the <code>History API</code>.</p> <p>Next semester you will be covering a handful more, and with that, you will have a very good grasp on what web developers
need 80% of the time.</p> <p>Here is the <a href="https://developer.mozilla.org/en-US/docs/Web/API" target="_blank" rel="noopener noreferrer">list of current Web APIs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on the MDN site with
documentation.</p> <h2 id="what-to-do-this-week"><a href="#what-to-do-this-week" class="header-anchor">#</a> What to do this week</h2> <div class="custom-block warning"><p class="custom-block-title">TODO Things to do before next week.</p> <ul><li>Read all the content from <code>Modules 13.1, 13.2, and 14.1</code>.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/27/2022, 1:51:05 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/F2022/modules/week12/destructure/" class="prev">
        12.2: Destructuring, Spead, &amp; Enumeration
      </a></span> <span class="next"><a href="/F2022/modules/week13/multi-page/">
        13.2: Multi-Page, SPA, and JAMStack 
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/F2022/assets/js/app.42156b92.js" defer></script><script src="/F2022/assets/js/2.309c8f6c.js" defer></script><script src="/F2022/assets/js/29.ba3d8131.js" defer></script><script src="/F2022/assets/js/4.8f0492b2.js" defer></script><script src="/F2022/assets/js/6.42129677.js" defer></script>
  </body>
</html>
